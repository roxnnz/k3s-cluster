This document describes how the k3s cluster has been installed and what configurations requries to get the cluster working in the current network setup.

## Describetion of current netowrk envrioment.

This cluster is hosted on a ubuntu server located in the local network. The ip address has been assigend to the host machine is "192.x.x.88".
The public ip of the network is "xxx.xxx.xxx.xxx" and issued by the internet provider.

## Requirement

- Ubuntu server
- Docker installed
- uwf diabled (by default)

## pre-installation check

Check port 80 is not blocked and accessable from other machines from the same local network.

1. Run: `python -m SimpleHTTPServer 80`

2. And goto: 192.x.x.88 from other machine and test the website is avialble and return 200 access response code.

if port 80 is not accessble from other machine, troubleshoot the firewall and routing table of the host machine of k3s.

## installation

Install k3s:

1. Run: `curl -sfL https://get.k3s.io | INSTALL_K3S_EXEC="--tls-san xxx.xxx.xxx.xxx" sh -`.

This is to install k3s with flag of including tls address for client access to the k3s cluster remotely.

More options visit: https://docs.k3s.io/installation/configuration or checkout the config file https://docs.k3s.io/installation/configuration#configuration-file

Get Access:

1. Export access config file to user directory by run: `sudo k3s kubectl config view --raw > ~/.kube/config`
2. `chmod 600 ~/.kube/config`
3. `export KUBECONFIG=~/.kube/config` or add KUBECONFIG in the ~/.bashrc file so this env variable get load everytime when terminal start.

Export access:

1. Copy content out from `sudo k3s kubectl config view --raw`
2. Replace server: https://127.0.0.1:6443 with public ip address.

## post installation test

1. visit "192.x.x.88" should see page of 404, generated by Traefik ingress controller which is the default ig come with k3s installation.

## Config route hardware

1. goto router's admin page
2. config port-forward
3. add rule for 22, 80 and 6443

## docker build example

1. Go to node-server folder and build a node web api and push the image

## Example Deployments

Node servers runing web api. this stack contains deployment and service, ingress for deploy a node web api using kubernetes.

1. Run: `kubectl apply -f deployments/node.yaml`

Nginx server running website. This stack contains deployment and service, ingress for a nginx servers.

1. Run: 'kubectl apply -f deployments/nginx.yaml`
